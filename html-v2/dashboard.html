<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
    <meta name="author" content=""/>
	 
    <title>Mikec's Dashboard : Franklin's 13 App</title> 
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap-mods.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive-mods.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="css/franklins13.css" type="text/css" media="screen" />
	
    <link rel="stylesheet" href="../web-app/css/jquery.qtip.min.css" />

		
</head>
<body>


<div class="container">

	<div class="row">
		<div class="span1 visible-desktop">&nbsp;</div>
		<div class="span5 show-border">&nbsp;</div>
		<div class="span5 align-right">
			<span class="welcome-message">Welcome back Mike</span>
			<a href="login.html" class="label label-warning">Logout</a>			
		</div>
		<div class="span1 visible-desktop">&nbsp;</div>
	</div>

	
	<div class="row">
		
		<div class="span1 visible-desktop">&nbsp;</div>		
		<div class="span4">
			<div class="userstats">
				<p class="lead">
					Total Score <em class="scoreWrapper"><code class="score"></code></em> 

					Rank <em class="rankWrapper"><code class="rank"></code></em> of 55
				</p>		
			</div>
		</div>
		
		<div class="span6">
			<div class="usernav pull-right">
				<ul class="nav nav-pills">
					<li><a href="account.html">Account</a></li>
					<li class=""><a href="logentry.html">Log Entry</a></li>
					<li><a href="history.html">History</a></li>
					<li class="active"><a href="dashboard.html">Dashboard</a></li>
				</ul>
			</div>
		</div>
		
		<div class="span1 visible-desktop">&nbsp;</div>
	</div>
	
	
	
	
	<div class="row">
		<div class="span1 visible-desktop">&nbsp;</div>
		
		<div class="span10" id="progressContainer">
			<div id="progress" style="width:800px; height:350px;"></div>
		</div>
		
		<div class="span1 visible-desktop">&nbsp;</div>
		
	</div>
	
	
	
	<div class="row">
		<div class="span1 visible-desktop">&nbsp;</div>
		
		<div class="span5">
			<div class="stats best stats-wrapper" style="display:none">
				<h2>Best 5</h2>
				<p>The Top 5 Virtues you have the most success in following</p>
				<table class="table table-bordered table-condensed">
					<tbody>
						<tr class="even">
							<td class="virtue">Industry</td>
							<td class="num">44</td>
							<td class="percent">88<em>%</em></td>
						</tr>
            	
					    <tr class="">
					    	<td class="virtue">Moderation</td>
					    	<td class="num">38</td>
					    	<td class="percent">80<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Order</td>
					    	<td class="num">32</td>
					    	<td class="percent">77<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Frugality</td>
					    	<td class="num">31</td>
					    	<td class="percent">76<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Justice</td>
					    	<td class="num">29</td>
					    	<td class="percent">74<em>%</em></td>
					    </tr>																	
					</tbody>
				</table>
			</div>			
		</div>
		
		<div class="span5">
			
			<div class="stats worst stats-wrapper" style="display:none">
				<h2>Worst 5</h2>
				<p>The 5 Virtues you have the hardest time following</p>
				<table class="table table-bordered table-condensed worst">
					<tbody>
						<tr class="even">
							<td class="virtue">Resolution</td>
							<td class="num">44</td>
							<td class="percent">88<em>%</em></td>
						</tr>
        		
					    <tr class="">
					    	<td class="virtue">Humility</td>
					    	<td class="num">38</td>
					    	<td class="percent">80<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Frugality</td>
					    	<td class="num">32</td>
					    	<td class="percent">77<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Silence</td>
					    	<td class="num">31</td>
					    	<td class="percent">76<em>%</em></td>
					    </tr>
					
					    <tr class="">
					    	<td class="virtue">Well Being</td>
					    	<td class="num">29</td>
					    	<td class="percent">74<em>%</em></td>
					    </tr>																	
					</tbody>				
				</table>
			</div>			
			
		</div>
		
		<div class="span1 visible-desktop">&nbsp;</div>	
	</div>
	


	<div class="row">
	 	<div class="span1 visible-desktop">&nbsp;</div>
		<div class="span10 page-header">
		</div>
		<div class="span1 visible-desktop">&nbsp;</div>
	</div>
		 
	<div class="row">
	 	<div class="span1 visible-desktop">&nbsp;</div>
		<div class="span10 footer">
			<p class="pull-right">
				<a href="welcome.html" class="" title="Franklins 13+ : Welcome to Franklin's 13+ App">Welcome</a>
				<a href="experiment.html" class="" title="Franklins 13+ : The Experiment Explained">The Experiment</a>
				<a href="virtues.html" class="" title="Franklins 13+ : Ben Franklin's 13 Virtues/Principals Defined">The Virtues</a>
				<a href="privacy.html" class="" title="Franklins 13+ : Privacy Policy">Privacy Policy</a>
			</p>
			<p>&copy;2012  - powered by grails, jquery, twitterbootstrap</p>
		</div>
		<div class="span1 visible-desktop">&nbsp;</div>
	</div>
	
</div>	
	
	
	

<script type="text/javascript" src="js/lib/jquery/1.7.2/jquery.js"></script>
<script type="text/javascript" src="../web-app/js/lib/jquery/jquery.qtip.min.js"></script>
<script type="text/javascript" src="../web-app/js/lib/jquery/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="../web-app/js/lib/jquery/flot/flot.js"></script>
<script type="text/javascript" src="../web-app/js/lib/jquery/fullcalendar/fullcalendar.min.js"></script>
<script type="text/javascript" src="../web-app/js/util/utilities.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>


<!-- MOCK DATA -->
<script type="text/javascript" src="js/mockdata.js"></script>

<script type="text/javascript">

	



	$(document).ready(function(){
		
		var $window = $(window);
		
		var resizeTimerId;
		$window.resize(function(){			
			clearTimeout(resizeTimerId);
			resizeTimerId = setTimeout(resizeChart, 500);
		});
		
		var $progressChartContainer = $('#progressContainer');
		var $progressChartDiv = $('#progress');
		function resizeChart(){
			var outerWidth = $window.outerWidth();
			console.log('done resizing ', outerWidth);
			
			var width = $progressChartContainer.width();
			$progressChartDiv.empty();
			$progressChartDiv.width(width)
			var dashGraph = new DashboardGraph($progressChartDiv);
			dashGraph.init();
			
		}
		
		
		var Dashboard = function(){
			
			var self = this;
			var score = 143;
			var startScore = 0;

			var startRank = 0;
			var rank = 23;
			
			var scoreTimerId;
			var rankTimerId;
			var startRankTimerId;
			
			var $scoreEm = $('.userstats .score');
			var $rankEm = $('.userstats .rank');
			
			self.init = function(){
				self.hideStats();
				//self.animatescore();
				self.animateRanking();
				self.startRankTimer();
				
				var dashGraph = new DashboardGraph($('#progress'));
				dashGraph.init();
				
				/**
				var dashCal = new DashboardCalendar($('#calendar'));
				dashCal.init();
				**/
				
				var dashStats = new DashboardStats($('.stats'));
				dashStats.animate();
				
				resizeChart();
				
			};
			
			self.hideStats = function(){
				// $scoreEm.css({"height":"0px", "opacity" : "0"});		
				// $rankEm.css({"height":"0px", "opacity" : "0"});		
			};
			
			self.startRankTimer = function(){
				startRankTimerId = window.setInterval(function(){
					//self.animateRanking();			
					self.animateScore();
					self.stopTimer(startRankTimerId)
				}, 400);			
			}
			
			self.animateRanking = function(){
				// $rankEm.animate({ height: '28', opacity: '1.0' }, 700);
				rankTimerId = window.setInterval(function(){
					self.incrementRank();	
				}, 40);
			}	
				
			self.animateScore = function(){
				// $scoreEm.animate({ height: '29', opacity: '1.0' }, 200);
				scoreTimerId = window.setInterval(function(){
					self.incrementScore();	
				}, 10);
			};

			self.incrementScore = function(){
				if(startScore != score && startScore < score){
					startScore++;
					
					if(score < 51){
						startScore++;
					}
					if(score > 50 && score < 151){
						startScore = startScore+2;
					}
					
					if(score > 150 && score < 251){
						startScore = startScore+5;
					}
					
					if(score > 250 && score < 1001){
						startScore = startScore+10;
					}
					
					if(score > 1000 && score < 2001){
						startScore = startScore+20;
					}
					
					if(score > 2000 && score < 10001){
						startScore = startScore+100;
					}
					
					if(score > 10000){
						startScore = startScore+550;
					}
					
					if(startScore > score){
						$scoreEm.html(score);
					}else{
						$scoreEm.html(startScore);
					}
					
				}else{
					self.stopTimer(scoreTimerId);
				}
			};
						
			self.incrementRank = function(){
				if(startRank != rank){
					startRank++;
					$rankEm.html(startRank)
				}else{
					self.stopTimer(rankTimerId);
				}
			};
			
			self.stopTimer = function(timerId){ 
		        clearInterval(timerId); 
		    };

			
			
			
		} 
		
		
		
		
		var DashboardGraph = function($graphDiv){
			
			var self = this;
			
			self.$graphDiv = $graphDiv;
				
			var happinessLabel = "Happiness/Satisfaction", 
				scoreLabel = "Score",
				virtuesLabel = "Virtues Followed";
				
			var HAPPINESS = 'happiness', 
				SCORE = 'score', 
				VIRTUES = 'virtues';
			
			var happinessObj = {}, 
				scoreObj = {},
				virtuesObj = {};
				
			self.quickDataObj = {};
			

			var virtueSeries = getVirtueSeriesConfig();
        	var happinessSeries = getHappinessSeriesConfig();
        	var scoresSeries = getScoreSeriesConfig();
	    	
		    var stack = 0, bars = false, lines = true, steps = false;
			
			var $dashGraph;
			var $graphContainerDiv = $('#dashleft');

			self.init = function(){
				self.render();
				self.fadeIn();
				self.bindHoverEvent();
			};
			
			self.render = function(){
				
				$dashGraph = $.plot(self.$graphDiv, 
					[ 
						virtueSeries, 
						happinessSeries,
						scoresSeries 
					], 
					{
						series: self.getSeriesConfig(),
						grid: self.getGridConfig(),
						legend: self.getLegend(),
						xaxis : self.getXAxis(),
						xaxis: { mode: "time" },
						yaxis: { min : -5, max:16 },
						plotclick : function(){
							console.log('plot clicked')
						}
            	
					}
				);

				self.setQuickLookupDataObj();
				
			};
		
			self.setQuickLookupDataObj = function(){
				var rawSeriesData = $dashGraph.getData();					
				$(rawSeriesData).each(function(index, series){	
					switch(series.label){
						case happinessLabel :
							self.setSeriesObj(happinessObj, series);
							break;
						case scoreLabel : 
							self.setSeriesObj(scoreObj, series);
							break;
						case virtuesLabel :
							self.setSeriesObj(virtuesObj, series);
							break;
						default :
							break;
					}
				});
				
				self.quickDataObj[SCORE] = scoreObj;
				self.quickDataObj[HAPPINESS] = happinessObj;
				self.quickDataObj[VIRTUES] = virtuesObj;
			}
		
			self.setSeriesObj = function(obj, series){
				$(series.data).each(function(index, datapoint){
					var timestamp = datapoint[0];
					var dataValue = datapoint[1];	
					obj[timestamp] = dataValue;
				});
			};
			
        	function getVirtueSeriesConfig(){
				return 	{
		    		color: '#11eb53',
		    		data: mockVirtues,
		    		label: virtuesLabel,
		    		// clickable: true,
					points: {
						show: true,
					    radius: 1,
					    symbol: "circle"
					},
		    		hoverable: true,
		    		shadowSize: 0
		  		};	
			};
			
        	
			function getHappinessSeriesConfig(){
				return 	{
		    		color: '#0F5D7E',
		    		data: mockHappiness,
		    		label: happinessLabel,
		    		// clickable: true,
					points: {
						show : true,
					    radius: 1,
					    symbol: "circle"
					},
		    		hoverable: true,
		    		shadowSize: 0
		  		};	
			};
        	
			
			function getScoreSeriesConfig(){
				return {
		    		color: '#C8330F',
		    		data: mockScores,
		    		label: scoreLabel,
		    		// clickable: true,
					points: {
						show : true,
					    radius: 1,
					    symbol: "circle"
					},
					clickable : true,
		    		hoverable: true,
		    		shadowSize: 0
		  		};	
			};
											
			self.getSeriesConfig = function(){
				return {
				    lines: { 
						show: lines, 
						fill: false,
						lineWidth: 2
					},
					points: {
				      radius: 1,
				      symbol: "circle"
				    },
					shadowSize: 3
				};
			};
		
		
			self.getGridConfig = function(){
				return  {
					show: true,
					aboveData: false,
					color: "#ddd",
					backgroundColor: "#f8f8f8",
					labelMargin: 10,
					axisMargin: 10,
					borderWidth: 1,
					borderColor: "#efefef",
					minBorderMargin: 10,
					clickable: true,
					hoverable: true,
					autoHighlight: true,
					mouseActiveRadius: 10
				};
			};
			
			
			self.getXAxis = function(){
				return {
				    show: true,
				    position: "bottom",
					color: "#f8f8f8",
				    tickColor: "#f8f8f8",
				    tickSize: 1,
				    minTickSize: 1
				};
			};
		
			
			self.getLegend = function(){
				return {
					show: true,
					labelBoxBorderColor: "#f8f8f8",
					position: "ne",
					margin: [10, 10],
					backgroundColor: "#f8f8f8",
					backgroundOpacity: 1.0
				};
			};
			
			self.$qtip;
			
			self.bindHoverEvent = function(){
				
				$('#progress').bind("plothover", function (event, pos, item) {
					
                	if (item) {					
						
					    if (previousPoint != item.dataIndex) {
					        previousPoint = item.dataIndex;
                	
							//console.log(event);
							//console.log(pos);
							//console.log(item);

							self.clearHighlighsAndQtip();
							
                			self.showQtip(self.formatGraphHover(item));

							
							self.highlightPoints(item);
							
					    }
					} else {
					    previousPoint = null;
						self.clearHighlighsAndQtip();
					}
					
				});
				
			};
			
			self.clearHighlighsAndQtip = function(){
				$dashGraph.unhighlight();
				if(self.$qtip)self.$qtip.qtip('hide');
			};
			
			self.highlightPoints = function(item){
				$dashGraph.highlight(0, item.dataIndex);
				$dashGraph.highlight(1, item.dataIndex);
				$dashGraph.highlight(2, item.dataIndex);
			};
			
			self.unhighlightPoints = function(item){
				
			};
			
			self.formatGraphHover = function(item){
				var timestamp = item.datapoint[0]
				var date = new Date(timestamp); 
				date = date.getUTCMonth() + 1 + '/' + date.getUTCDate() + '/' + date.getUTCFullYear();

				var title = '<em class="qtiptitle">Results for ' + date + '</em>';
				
				var virtuesString = '<span class="qtipstat">virtues completed : <em>' + self.quickDataObj.virtues[timestamp] + '</em></span>';
				var happinessString = '<span class="qtipstat">happiness : <em>' + self.quickDataObj.happiness[timestamp] + '</em></span>';
				var scoreString = '<span class="qtipstat">score : <em>' + self.quickDataObj.score[timestamp] + '</em></span>';
				
				return title + virtuesString + happinessString + scoreString;
			};
			
			self.showQtip = function(content){
				self.$qtip = $('#progress').qtip({
			   		content: {
			   			text : content
			   		},
			   		
			   		position: {
			   		   my: 'top left',
			   		   target: 'mouse',
			   		   //viewport: $(window), // Keep it on-screen at all times if possible
			   		   adjust: {
			   		      x: 10,  y: 10
			   		   }
			   		},
			   		hide: {
						leave: false,
			   		   	fixed: true // Helps to prevent the tooltip from hiding ocassionally when tracking!
			   		},
					show		: { delay : 0 },
			   		style: {
			   			classes: 'ui-tooltip-youtube'
			   		}
				});
				self.$qtip.qtip('show');			
				
			};
			
			
			
			
			
			self.fadeIn = function(){	
				if($graphDiv){
					$graphContainerDiv.fadeIn();
				}			
			};
			
		}
		
		
		
		
		
		var DashboardCalendar = function($calendarDiv){
			var self = this;
			
			self.$calendarDiv = $calendarDiv;
			
			
			var $day = $('.fc-widget-content');
			var $loading = $('#loading');
			var $calendarWrapper = $('#calendarWrapper');
			
			var $calendar;
			
			self.mockEvents = [{"id":"2012-01-10", "title":"+15", "url":"show/1", "start":"2012-01-10"}, {"id":"2012-01-15", "title":"+4", "url":"show/1", "start":"2012-01-15"}];
					
					
			self.init = function(){
				self.render();
				self.bindQtipOnEvents();
			};


			self.render = function(){
				$calendar = self.$calendarDiv.fullCalendar({
					
					//events : "entries",
					events : self.mockEvents,
					disableDragging : true,
					selectable : true,
					select : function(start, end, allDay, jsEvent, view, onevent){
						
						var $cellOverlay = 	$('.fc-cell-overlay');
						
						var dateString = start.getFullYear() + '-' + (start.getMonth() + 1) + '-' + start.getDate();
						var today = new Date();
						var result = util.dates.compare(start, today);
						
						if(result === 1){
							
							var message = 'Cannot log entry for the future... what are you trying to pull here...';
							
							$cellOverlay.qtip({
								content: {
									text: message
								},
							   	position: {
							    	my: 'bottom center',  // Position my top left...
							      	at: 'top center', // at the bottom right of...
							    },
								style: {
									classes: 'ui-tooltip-youtube'
								}
							});
							$cellOverlay.qtip().show();
							
						}else{
							window.location = '/franklins13/virtueEntry/logEntry?date=' + dateString;
						}
						
					},
					loading : function(bool) {
						if (bool){
							$loading.show();	
						} else {
							$loading.hide();
						}
					},
					eventRender: function(event, element) {}
            	
				});				
			};
			
			self.bindQtipOnEvents = function(){
				$('.fc-event').qtip({
					content: {
						text: "View Details"
					},
					position: {
						my: 'bottom center',  // Position my top left...
					  	at: 'top center', // at the bottom right of...
					},
					style: {
						classes: 'ui-tooltip-youtube'
					}
					
				});
			};
			
			self.zeroPad = function(num, count){
				var numZeropad = num + '';
				while(numZeropad.length < count) {
					numZeropad = "0" + numZeropad;
				}
				return numZeropad;
			}
		}
		
		
		var DashboardStats = function($statsDiv){
			var self = this;
			self.$statsDiv = $statsDiv;
			
			self.animate = function(){
				
				self.$statsDiv.fadeIn(800);
				self.$statsDiv.fadeIn(500);
			};
			
		}
			
		var dash = new Dashboard();
		dash.init();

		
	});


</script>
	

</body>
</html>
